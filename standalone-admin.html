<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Management Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            color: #333;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #5568d3;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th,
        table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table th {
            background: #f8f9fa;
            color: #333;
            font-weight: 600;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-active {
            background: #d4edda;
            color: #155724;
        }

        .badge-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-running {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-stopped {
            background: #e2e3e5;
            color: #383d41;
        }

        .alert {
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .login-container h2 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .hidden {
            display: none;
        }

        .logout-btn {
            float: right;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <h2>Admin Login</h2>
        <div id="loginError" class="alert alert-error hidden"></div>
        <div class="form-group">
            <label>Username</label>
            <input type="text" id="loginUsername" placeholder="Enter username">
        </div>
        <div class="form-group">
            <label>Password</label>
            <input type="password" id="loginPassword" placeholder="Enter password">
        </div>
        <button class="btn" onclick="login()" style="width: 100%;">Login</button>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="container hidden">
        <div class="header">
            <h1>Bot Management Admin Panel</h1>
            <button class="btn btn-danger logout-btn" onclick="logout()">Logout</button>
            <p>Manage users, bots, and access tokens</p>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('users')">Users</button>
            <button class="tab-btn" onclick="switchTab('bots')">Bots</button>
            <button class="tab-btn" onclick="switchTab('tokens')">Access Tokens</button>
        </div>

        <!-- Users Tab -->
        <div id="usersTab" class="tab-content active">
            <div class="card">
                <h2>Create New User</h2>
                <div id="userMessage" class="hidden"></div>
                <form onsubmit="createUser(event)">
                    <div class="grid">
                        <div class="form-group">
                            <label>First Name</label>
                            <input type="text" id="userFirstName" required>
                        </div>
                        <div class="form-group">
                            <label>Last Name</label>
                            <input type="text" id="userLastName" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="userEmail" required>
                    </div>
                    <button type="submit" class="btn">Create User</button>
                </form>
            </div>

            <div class="card">
                <h2>All Users</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Created At</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Bots Tab -->
        <div id="botsTab" class="tab-content">
            <div class="card">
                <h2>Create New Bot</h2>
                <div id="botMessage" class="hidden"></div>
                <form onsubmit="createBot(event)">
                    <div class="form-group">
                        <label>User</label>
                        <select id="botUserId" required>
                            <option value="">Select User</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Bot Name</label>
                        <input type="text" id="botName" required>
                    </div>
                    <div class="form-group">
                        <label>Runtime</label>
                        <select id="botRuntime" required>
                            <option value="python">Python</option>
                            <option value="nodejs">Node.js</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Create Bot</button>
                </form>
            </div>

            <div class="card">
                <h2>All Bots</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>User</th>
                            <th>Runtime</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="botsTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tokens Tab -->
        <div id="tokensTab" class="tab-content">
            <div class="card">
                <h2>Create Access Token</h2>
                <div id="tokenMessage" class="hidden"></div>
                <form onsubmit="createToken(event)">
                    <div class="form-group">
                        <label>User</label>
                        <select id="tokenUserId" required>
                            <option value="">Select User</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Generate Token</button>
                </form>
            </div>

            <div class="card">
                <h2>All Access Tokens</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Token</th>
                            <th>User</th>
                            <th>Status</th>
                            <th>Created At</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tokensTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Admin credentials (default: admin/admin123)
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: 'admin123'
        };

        // Initialize data from localStorage
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let bots = JSON.parse(localStorage.getItem('bots')) || [];
        let tokens = JSON.parse(localStorage.getItem('tokens')) || [];

        // Check if logged in
        function checkAuth() {
            const isLoggedIn = sessionStorage.getItem('isAdmin');
            if (isLoggedIn === 'true') {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                loadData();
            }
        }

        // Login function
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                sessionStorage.setItem('isAdmin', 'true');
                errorDiv.classList.add('hidden');
                checkAuth();
            } else {
                errorDiv.textContent = 'Invalid username or password';
                errorDiv.classList.remove('hidden');
            }
        }

        // Logout function
        function logout() {
            sessionStorage.removeItem('isAdmin');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
        }

        // Switch tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // Generate random ID
        function generateId() {
            return 'id_' + Math.random().toString(36).substr(2, 9);
        }

        // Generate token
        function generateToken() {
            return 'tok_' + Math.random().toString(36).substr(2, 16) + Math.random().toString(36).substr(2, 16);
        }

        // Show message
        function showMessage(elementId, message, isError = false) {
            const messageDiv = document.getElementById(elementId);
            messageDiv.textContent = message;
            messageDiv.className = isError ? 'alert alert-error' : 'alert alert-success';
            messageDiv.classList.remove('hidden');
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 3000);
        }

        // Create User
        function createUser(event) {
            event.preventDefault();
            
            const firstName = document.getElementById('userFirstName').value;
            const lastName = document.getElementById('userLastName').value;
            const email = document.getElementById('userEmail').value;

            // Check if email already exists
            if (users.find(u => u.email === email)) {
                showMessage('userMessage', 'User with this email already exists', true);
                return;
            }

            const newUser = {
                id: generateId(),
                firstName,
                lastName,
                email,
                createdAt: new Date().toISOString()
            };

            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            showMessage('userMessage', 'User created successfully');
            event.target.reset();
            loadUsers();
            updateUserSelects();
        }

        // Delete User
        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user? All associated bots and tokens will also be deleted.')) {
                users = users.filter(u => u.id !== userId);
                bots = bots.filter(b => b.userId !== userId);
                tokens = tokens.filter(t => t.userId !== userId);
                
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('bots', JSON.stringify(bots));
                localStorage.setItem('tokens', JSON.stringify(tokens));
                
                loadData();
            }
        }

        // Create Bot
        function createBot(event) {
            event.preventDefault();
            
            const userId = document.getElementById('botUserId').value;
            const name = document.getElementById('botName').value;
            const runtime = document.getElementById('botRuntime').value;

            const newBot = {
                id: generateId(),
                userId,
                name,
                runtime,
                status: 'stopped',
                createdAt: new Date().toISOString()
            };

            bots.push(newBot);
            localStorage.setItem('bots', JSON.stringify(bots));
            
            showMessage('botMessage', 'Bot created successfully');
            event.target.reset();
            loadBots();
        }

        // Toggle Bot Status
        function toggleBotStatus(botId) {
            const bot = bots.find(b => b.id === botId);
            if (bot) {
                bot.status = bot.status === 'running' ? 'stopped' : 'running';
                localStorage.setItem('bots', JSON.stringify(bots));
                loadBots();
            }
        }

        // Delete Bot
        function deleteBot(botId) {
            if (confirm('Are you sure you want to delete this bot?')) {
                bots = bots.filter(b => b.id !== botId);
                localStorage.setItem('bots', JSON.stringify(bots));
                loadBots();
            }
        }

        // Create Token
        function createToken(event) {
            event.preventDefault();
            
            const userId = document.getElementById('tokenUserId').value;
            const tokenValue = generateToken();

            const newToken = {
                id: generateId(),
                token: tokenValue,
                userId,
                isActive: true,
                createdAt: new Date().toISOString()
            };

            tokens.push(newToken);
            localStorage.setItem('tokens', JSON.stringify(tokens));
            
            showMessage('tokenMessage', 'Token generated successfully: ' + tokenValue);
            event.target.reset();
            loadTokens();
        }

        // Toggle Token Status
        function toggleTokenStatus(tokenId) {
            const token = tokens.find(t => t.id === tokenId);
            if (token) {
                token.isActive = !token.isActive;
                localStorage.setItem('tokens', JSON.stringify(tokens));
                loadTokens();
            }
        }

        // Delete Token
        function deleteToken(tokenId) {
            if (confirm('Are you sure you want to delete this token?')) {
                tokens = tokens.filter(t => t.id !== tokenId);
                localStorage.setItem('tokens', JSON.stringify(tokens));
                loadTokens();
            }
        }

        // Load Users
        function loadUsers() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.firstName} ${user.lastName}</td>
                    <td>${user.email}</td>
                    <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteUser('${user.id}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load Bots
        function loadBots() {
            const tbody = document.getElementById('botsTableBody');
            tbody.innerHTML = '';

            bots.forEach(bot => {
                const user = users.find(u => u.id === bot.userId);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${bot.name}</td>
                    <td>${user ? user.email : 'Unknown'}</td>
                    <td>${bot.runtime}</td>
                    <td>
                        <span class="badge ${bot.status === 'running' ? 'badge-running' : 'badge-stopped'}">
                            ${bot.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn ${bot.status === 'running' ? 'btn-danger' : 'btn-success'}" 
                                onclick="toggleBotStatus('${bot.id}')">
                            ${bot.status === 'running' ? 'Stop' : 'Start'}
                        </button>
                        <button class="btn btn-danger" onclick="deleteBot('${bot.id}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load Tokens
        function loadTokens() {
            const tbody = document.getElementById('tokensTableBody');
            tbody.innerHTML = '';

            tokens.forEach(token => {
                const user = users.find(u => u.id === token.userId);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${token.token}</td>
                    <td>${user ? user.email : 'Unknown'}</td>
                    <td>
                        <span class="badge ${token.isActive ? 'badge-active' : 'badge-inactive'}">
                            ${token.isActive ? 'Active' : 'Inactive'}
                        </span>
                    </td>
                    <td>${new Date(token.createdAt).toLocaleDateString()}</td>
                    <td>
                        <button class="btn" onclick="toggleTokenStatus('${token.id}')">
                            ${token.isActive ? 'Deactivate' : 'Activate'}
                        </button>
                        <button class="btn btn-danger" onclick="deleteToken('${token.id}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update user selects
        function updateUserSelects() {
            const botUserSelect = document.getElementById('botUserId');
            const tokenUserSelect = document.getElementById('tokenUserId');

            [botUserSelect, tokenUserSelect].forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">Select User</option>';
                users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = `${user.firstName} ${user.lastName} (${user.email})`;
                    select.appendChild(option);
                });
                select.value = currentValue;
            });
        }

        // Load all data
        function loadData() {
            loadUsers();
            loadBots();
            loadTokens();
            updateUserSelects();
        }

        // Initialize on page load
        checkAuth();
    </script>
</body>
</html>
